export type Language = 'en' | 'is' | 'no' | 'nl';

type TranslationValue = string | string[] | TranslationTree;
interface TranslationTree {
  [key: string]: TranslationValue;
}

const DEFAULT_LANGUAGE: Language = 'en';

export const translations: Record<Language, TranslationTree> = {
  en: {
    app: {
      title: 'Vegvisr AI Chat',
      badge: 'Early Access'
    },
    chat: {
      title: 'Vegvisr AI Console',
      subtitle: 'Migration slice 1: layout + provider selector',
      provider: 'Provider',
      model: 'Model',
      userId: 'User id',
      userIdHelp: 'Used to load the correct API key.',
      contextTools: 'Use graph context',
      selectionContext: 'Use selection context',
      profileLookup: 'Proff lookup',
      sourcesTools: 'Sources tools',
      templateTools: 'Template tools',
      contextHint: 'These toggles are placeholders for context/tool wiring in the next slice.',
      fileAttach: 'Attach image',
      fileAttachDisabled: 'Attach image (not available for Grok)',
      imageAttached: 'Image attached',
      audioAttach: 'Attach audio',
      clearAttachments: 'Clear attachments',
      emptyState: 'Start a conversation. Messages will render here.',
      linkPreview: 'Link preview',
      thinking: 'Thinking…',
      historySyncing: 'Syncing chat history…',
      historySynced: 'History synced at',
      historyWillSave: 'History will be saved for this chat.',
      sessions: 'Sessions',
      newSession: 'New session',
      sessionsLoading: 'Loading sessions…',
      sessionsEmpty: 'No saved sessions yet.',
      sessionUntitled: 'Untitled session',
      sessionUpdated: 'Updated',
      sessionOpen: 'Open',
      sessionCurrent: 'Current',
      sessionRename: 'Rename',
      sessionRenameCancel: 'Cancel',
      sessionRenaming: 'Renaming…',
      sessionDelete: 'Delete',
      sessionDeleting: 'Deleting…',
      sessionRenameRequired: 'Please enter a session title.',
      sessionRenameError: 'Failed to rename session.',
      audioAutoDetect: 'Auto-detect language',
      audioTranscribe: 'Transcribe & Insert',
      audioTranscribing: 'Transcribing...',
      audioPreparing: 'Preparing audio...',
      audioUploading: 'Uploading audio...',
      audioChunking: 'Splitting audio into chunks...',
      audioPreparingChunk: 'Preparing chunk',
      audioProcessingChunk: 'Processing chunk',
      audioChunkComplete: 'Chunk complete',
      audioChunkFailed: 'Chunk failed',
      audioChunkRetry: 'Chunking failed. Retrying whole file...',
      audioTranscriptionFailed: 'Audio transcription failed',
      audioUnsupported: 'Unsupported audio format. Allowed: wav, mp3, m4a, aac, ogg, opus, mp4, webm.',
      audioReadFailed: 'Failed to read the selected audio file. Please try another file.',
      audioDurationLabel: 'Duration:',
      audioDurationUnknown: 'Unknown',
      audioLanguageLabel: 'Language:',
      audioTranscriptionFor: 'Transcription for',
      audioNoSpeech: '_No speech detected_',
      audioUploadedMessage: 'Uploaded audio',
      audioChunkLabel: 'Chunk',
      settingsTitle: 'Settings',
      settingsShow: 'Show settings',
      settingsHide: 'Hide settings',
      imageNotSupported: 'Image analysis is not supported for this provider. Switch to OpenAI, Claude, Gemini, or Perplexity.',
      responseFontSize: 'Response size',
      fontSmall: 'Small',
      fontMedium: 'Medium',
      fontLarge: 'Large',
      message: 'Message',
      messagePlaceholder: 'Type a message...',
      send: 'Send',
      streaming: 'Streaming…',
      placeholderNote: 'Chat content will render here next. This slice only includes layout and provider selection.'
    }
  },
  is: {
    app: {
      title: 'Vegvisr AI Spjall',
      badge: 'Snemma aðgangur'
    },
    chat: {
      title: 'Vegvisr AI Console',
      subtitle: 'Færslusneið 1: uppsetning + veitanda val',
      provider: 'Veitandi',
      model: 'Líkan',
      userId: 'Notandaauðkenni',
      userIdHelp: 'Notað til að hlaða réttu API-lykli.',
      contextTools: 'Nota graph samhengi',
      selectionContext: 'Nota val samhengi',
      profileLookup: 'Proff leit',
      sourcesTools: 'Sources verkfæri',
      templateTools: 'Template verkfæri',
      contextHint: 'Þessar rofar eru staðgenglar fyrir samhengi/verkfæri í næstu sneið.',
      fileAttach: 'Bæta við mynd',
      fileAttachDisabled: 'Bæta við mynd (ekki í boði fyrir Grok)',
      imageAttached: 'Mynd hengd við',
      audioAttach: 'Bæta við hljóði',
      clearAttachments: 'Hreinsa viðhengi',
      emptyState: 'Byrjaðu samtal. Skilaboð birtast hér.',
      linkPreview: 'Forskoðun á tengli',
      thinking: 'Hugsar…',
      historySyncing: 'Samstillir spjallferil…',
      historySynced: 'Ferill samstilltur kl.',
      historyWillSave: 'Ferill verður vistaður fyrir þetta spjall.',
      sessions: 'Lotur',
      newSession: 'Ný lota',
      sessionsLoading: 'Hleð lotum…',
      sessionsEmpty: 'Engar vistaðar lotur enn.',
      sessionUntitled: 'Ónefnd lota',
      sessionUpdated: 'Uppfært',
      sessionOpen: 'Opna',
      sessionCurrent: 'Núverandi',
      sessionRename: 'Endurnefna',
      sessionRenameCancel: 'Hætta við',
      sessionRenaming: 'Endurnefni…',
      sessionDelete: 'Eyða',
      sessionDeleting: 'Eyði…',
      sessionRenameRequired: 'Vinsamlegast sláðu inn heiti lotu.',
      sessionRenameError: 'Mistókst að endurnefna lotu.',
      audioAutoDetect: 'Sjálfvirk tungumálagreining',
      audioTranscribe: 'Umrita og setja inn',
      audioTranscribing: 'Umritar...',
      audioPreparing: 'Undirbý hljóð...',
      audioUploading: 'Hleð upp hljóði...',
      audioChunking: 'Skipti hljóði í búta...',
      audioPreparingChunk: 'Undirbý bút',
      audioProcessingChunk: 'Vinn bút',
      audioChunkComplete: 'Bút lokið',
      audioChunkFailed: 'Bút mistókst',
      audioChunkRetry: 'Bútun mistókst. Reyni allt skrána...',
      audioTranscriptionFailed: 'Umritun mistókst',
      audioUnsupported: 'Óstudd hljóðskrá. Leyfilegt: wav, mp3, m4a, aac, ogg, opus, mp4, webm.',
      audioReadFailed: 'Mistókst að lesa hljóðskrána. Reyndu aftur.',
      audioDurationLabel: 'Lengd:',
      audioDurationUnknown: 'Óþekkt',
      audioLanguageLabel: 'Tungumál:',
      audioTranscriptionFor: 'Umritun fyrir',
      audioNoSpeech: '_Engin talgreining_',
      audioUploadedMessage: 'Hlaðið upp hljóði',
      audioChunkLabel: 'Bútur',
      settingsTitle: 'Stillingar',
      settingsShow: 'Sýna stillingar',
      settingsHide: 'Fela stillingar',
      imageNotSupported: 'Myndagreining er ekki studd fyrir þessa veitanda. Skiptu í OpenAI, Claude, Gemini eða Perplexity.',
      responseFontSize: 'Svarstærð',
      fontSmall: 'Lítið',
      fontMedium: 'Miðlungs',
      fontLarge: 'Stórt',
      message: 'Skilaboð',
      messagePlaceholder: 'Skrifaðu skilaboð...',
      send: 'Senda',
      streaming: 'Streymir…',
      placeholderNote: 'Spjall birtist hér næst. Þessi sneið nær aðeins yfir uppsetningu og veitandaval.'
    }
  },
  no: {
    app: {
      title: 'Vegvisr AI Chat',
      badge: 'Tidlig tilgang'
    },
    chat: {
      title: 'Vegvisr AI Console',
      subtitle: 'Migreringsdel 1: layout + leverandørvalg',
      provider: 'Leverandør',
      model: 'Modell',
      userId: 'Bruker-id',
      userIdHelp: 'Brukes for å hente riktig API-nøkkel.',
      contextTools: 'Bruk graph-kontekst',
      selectionContext: 'Bruk utvalgskontekst',
      profileLookup: 'Proff-oppslag',
      sourcesTools: 'Sources-verktøy',
      templateTools: 'Template-verktøy',
      contextHint: 'Disse bryterne er plassholdere for kontekst/verktøy i neste del.',
      fileAttach: 'Legg ved bilde',
      fileAttachDisabled: 'Legg ved bilde (ikke tilgjengelig for Grok)',
      imageAttached: 'Bilde er vedlagt',
      audioAttach: 'Legg ved lyd',
      clearAttachments: 'Fjern vedlegg',
      emptyState: 'Start en samtale. Meldinger vises her.',
      linkPreview: 'Lenkeforhåndsvisning',
      thinking: 'Tenker…',
      historySyncing: 'Synkroniserer chatlogg…',
      historySynced: 'Historikk synkronisert kl.',
      historyWillSave: 'Historikk lagres for denne chatten.',
      sessions: 'Økter',
      newSession: 'Ny økt',
      sessionsLoading: 'Laster økter…',
      sessionsEmpty: 'Ingen lagrede økter ennå.',
      sessionUntitled: 'Uten tittel',
      sessionUpdated: 'Oppdatert',
      sessionOpen: 'Åpne',
      sessionCurrent: 'Gjeldende',
      sessionRename: 'Gi nytt navn',
      sessionRenameCancel: 'Avbryt',
      sessionRenaming: 'Lagrer…',
      sessionDelete: 'Slett',
      sessionDeleting: 'Sletter…',
      sessionRenameRequired: 'Skriv inn en tittel.',
      sessionRenameError: 'Kunne ikke gi nytt navn.',
      audioAutoDetect: 'Auto-gjenkjenning av språk',
      audioTranscribe: 'Transkriber og sett inn',
      audioTranscribing: 'Transkriberer...',
      audioPreparing: 'Klargjør lyd...',
      audioUploading: 'Laster opp lyd...',
      audioChunking: 'Deler lyd i biter...',
      audioPreparingChunk: 'Klargjør bit',
      audioProcessingChunk: 'Behandler bit',
      audioChunkComplete: 'Bit fullført',
      audioChunkFailed: 'Bit feilet',
      audioChunkRetry: 'Biter feilet. Prøver hele filen...',
      audioTranscriptionFailed: 'Lydtranskripsjon mislyktes',
      audioUnsupported: 'Ugyldig lydformat. Tillatt: wav, mp3, m4a, aac, ogg, opus, mp4, webm.',
      audioReadFailed: 'Kunne ikke lese lydfilen. Prøv en annen fil.',
      audioDurationLabel: 'Varighet:',
      audioDurationUnknown: 'Ukjent',
      audioLanguageLabel: 'Språk:',
      audioTranscriptionFor: 'Transkripsjon for',
      audioNoSpeech: '_Ingen tale oppdaget_',
      audioUploadedMessage: 'Lastet opp lyd',
      audioChunkLabel: 'Bit',
      settingsTitle: 'Innstillinger',
      settingsShow: 'Vis innstillinger',
      settingsHide: 'Skjul innstillinger',
      imageNotSupported: 'Bildeanalyse støttes ikke for denne leverandøren. Bytt til OpenAI, Claude, Gemini eller Perplexity.',
      responseFontSize: 'Svarstørrelse',
      fontSmall: 'Liten',
      fontMedium: 'Middels',
      fontLarge: 'Stor',
      message: 'Melding',
      messagePlaceholder: 'Skriv en melding...',
      send: 'Send',
      streaming: 'Strømmer…',
      placeholderNote: 'Chatinn vises her neste gang. Denne delen inneholder kun layout og leverandørvalg.'
    }
  },
  nl: {
    app: {
      title: 'Vegvisr AI Chat',
      badge: 'Vroege toegang'
    },
    chat: {
      title: 'Vegvisr AI Console',
      subtitle: 'Migratieslice 1: layout + providerkeuze',
      provider: 'Provider',
      model: 'Model',
      userId: 'Gebruiker-id',
      userIdHelp: 'Wordt gebruikt om de juiste API-sleutel te laden.',
      contextTools: 'Gebruik graph-context',
      selectionContext: 'Gebruik selectiecontext',
      profileLookup: 'Proff-zoekopdracht',
      sourcesTools: 'Sources tools',
      templateTools: 'Template tools',
      contextHint: 'Deze schakelaars zijn placeholders voor context/tool wiring in de volgende slice.',
      fileAttach: 'Afbeelding toevoegen',
      fileAttachDisabled: 'Afbeelding toevoegen (niet beschikbaar voor Grok)',
      imageAttached: 'Afbeelding toegevoegd',
      audioAttach: 'Audio toevoegen',
      clearAttachments: 'Bijlagen wissen',
      emptyState: 'Start een gesprek. Berichten verschijnen hier.',
      linkPreview: 'Linkvoorbeeld',
      thinking: 'Bezig…',
      historySyncing: 'Chatgeschiedenis synchroniseren…',
      historySynced: 'Geschiedenis gesynchroniseerd om',
      historyWillSave: 'Geschiedenis wordt opgeslagen voor deze chat.',
      sessions: 'Sessies',
      newSession: 'Nieuwe sessie',
      sessionsLoading: 'Sessies laden…',
      sessionsEmpty: 'Nog geen opgeslagen sessies.',
      sessionUntitled: 'Naamloze sessie',
      sessionUpdated: 'Bijgewerkt',
      sessionOpen: 'Openen',
      sessionCurrent: 'Huidige',
      sessionRename: 'Hernoemen',
      sessionRenameCancel: 'Annuleren',
      sessionRenaming: 'Opslaan…',
      sessionDelete: 'Verwijderen',
      sessionDeleting: 'Verwijderen…',
      sessionRenameRequired: 'Voer een sessietitel in.',
      sessionRenameError: 'Sessienaam wijzigen mislukt.',
      audioAutoDetect: 'Taal automatisch detecteren',
      audioTranscribe: 'Transcriberen en invoegen',
      audioTranscribing: 'Transcriberen...',
      audioPreparing: 'Audio voorbereiden...',
      audioUploading: 'Audio uploaden...',
      audioChunking: 'Audio in segmenten splitsen...',
      audioPreparingChunk: 'Segment voorbereiden',
      audioProcessingChunk: 'Segment verwerken',
      audioChunkComplete: 'Segment voltooid',
      audioChunkFailed: 'Segment mislukt',
      audioChunkRetry: 'Segmenteren mislukt. Hele bestand opnieuw...',
      audioTranscriptionFailed: 'Audio-transcriptie mislukt',
      audioUnsupported: 'Niet-ondersteund audioformaat. Toegestaan: wav, mp3, m4a, aac, ogg, opus, mp4, webm.',
      audioReadFailed: 'Kon audiobestand niet lezen. Probeer een ander bestand.',
      audioDurationLabel: 'Duur:',
      audioDurationUnknown: 'Onbekend',
      audioLanguageLabel: 'Taal:',
      audioTranscriptionFor: 'Transcriptie voor',
      audioNoSpeech: '_Geen spraak gedetecteerd_',
      audioUploadedMessage: 'Audio geupload',
      audioChunkLabel: 'Segment',
      settingsTitle: 'Instellingen',
      settingsShow: 'Instellingen tonen',
      settingsHide: 'Instellingen verbergen',
      imageNotSupported: 'Beeldanalyse wordt niet ondersteund voor deze provider. Schakel over naar OpenAI, Claude, Gemini of Perplexity.',
      responseFontSize: 'Antwoordgrootte',
      fontSmall: 'Klein',
      fontMedium: 'Middel',
      fontLarge: 'Groot',
      message: 'Bericht',
      messagePlaceholder: 'Typ een bericht...',
      send: 'Versturen',
      streaming: 'Streamen…',
      placeholderNote: 'Chatcontent verschijnt hierna. Deze slice bevat alleen layout en providerkeuze.'
    }
  }
};

const walk = (tree: TranslationTree, parts: string[]): TranslationValue | undefined => {
  let current: TranslationValue = tree;
  for (const part of parts) {
    if (!current || typeof current !== 'object' || Array.isArray(current)) {
      return undefined;
    }
    current = (current as TranslationTree)[part];
  }
  return current;
};

export const getTranslation = (language: Language, key: string) => {
  const parts = key.split('.');
  const langTree = translations[language] || translations[DEFAULT_LANGUAGE];
  const value = walk(langTree, parts);
  if (typeof value === 'string') {
    return value;
  }
  const fallbackValue = walk(translations[DEFAULT_LANGUAGE], parts);
  if (typeof fallbackValue === 'string') {
    return fallbackValue;
  }
  return key;
};
